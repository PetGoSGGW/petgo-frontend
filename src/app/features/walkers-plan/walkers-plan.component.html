<app-section-wrapper header="Kalendarz spacerów">
  @if (dogsWithReservations.isLoading()) {
    <mat-spinner />
  } @else if (dogsWithReservations.error()) {
    <mat-error>Wystąpił błąd.</mat-error>
  } @else if (dogsWithReservations.hasValue()) {
    <div class="plan">
      <div class="month-nav">
        <button
          type="button"
          matIconButton
          aria-label="Poprzedni miesiąc"
          (click)="shiftMonth(-1)"
        >
          <mat-icon>chevron_left</mat-icon>
        </button>

        <span class="month-label">{{ monthLabel() }}</span>

        <button
          type="button"
          matIconButton
          aria-label="Następny miesiąc"
          (click)="shiftMonth(1)"
        >
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      <div class="calendar">
        <div class="weekdays">
          @for (label of weekDays; track label) {
            <span>{{ label }}</span>
          }
        </div>

        <div class="grid">
          @for (cell of calendarCells(); track $index) {
            @if (cell.day) {
              <button
                type="button"
                class="day-cell"
                [class.owner]="cell.isOwner"
                [class.walker]="cell.isWalker"
                [class.both]="cell.isOwner && cell.isWalker"
                [class.completed]="cell.isCompleted"
                [class.clickable]="cell.reservationId"
                [disabled]="!cell.reservationId"
                [attr.aria-label]="cell.ariaLabel"
                (click)="openReservation(cell.reservationId)"
              >
                <span class="day-number">{{ cell.day }}</span>
                @if (cell.isOwner || cell.isWalker) {
                  <span class="dot-row">
                    @if (cell.isOwner) {
                      <span class="dot owner"></span>
                    }
                    @if (cell.isWalker) {
                      <span class="dot walker"></span>
                    }
                  </span>
                }
                @if (cell.isCompleted) {
                  <mat-icon class="completed-icon" aria-hidden="true">check</mat-icon>
                }
              </button>
            } @else {
              <div class="day-cell empty"></div>
            }
          }
        </div>

        <div class="legend">
          <span class="legend-item">
            <span class="dot owner"></span>
            <span>Właściciel</span>
          </span>
          <span class="legend-item">
            <span class="dot walker"></span>
            <span>Walker</span>
          </span>
        </div>
      </div>

      <div class="upcoming">
        <span class="upcoming-title">Nadchodzące spacery</span>
        <mat-tab-group>
          <mat-tab label="WŁAŚCICIEL">
            @if (plannedOwner().length) {
              <div class="planned-list">
                @for (item of plannedOwner(); track item.reservationId) {
                  <button
                    type="button"
                    class="planned-item owner"
                    (click)="openReservation(item.reservationId)"
                  >
                    <mat-icon class="planned-icon">event_available</mat-icon>
                    <div class="planned-text">
                      <span class="planned-title">{{ item.dateLabel }} • {{ item.time }}</span>
                      <span class="planned-subtitle">Pies: {{ item.dogName }}</span>
                      <span class="planned-status">Status: {{ statusLabel(item.status) }}</span>
                    </div>
                    <mat-icon class="chevron">chevron_right</mat-icon>
                  </button>
                }
              </div>
            } @else {
              <div class="empty">Brak zaplanowanych spacerów.</div>
            }
          </mat-tab>
          <mat-tab label="WALKER">
            @if (plannedWalker().length) {
              <div class="planned-list">
                @for (item of plannedWalker(); track item.reservationId) {
                  <button
                    type="button"
                    class="planned-item walker"
                    (click)="openReservation(item.reservationId)"
                  >
                    <mat-icon class="planned-icon">event_available</mat-icon>
                    <div class="planned-text">
                      <span class="planned-title">{{ item.dateLabel }} • {{ item.time }}</span>
                      <span class="planned-subtitle">Pies: {{ item.dogName }}</span>
                      <span class="planned-status">Status: {{ statusLabel(item.status) }}</span>
                    </div>
                    <mat-icon class="chevron">chevron_right</mat-icon>
                  </button>
                }
              </div>
            } @else {
              <div class="empty">Brak zaplanowanych spacerów.</div>
            }
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  }
</app-section-wrapper>
