<div class="chat-container">
  <header class="chat-header">
    <div class="header-content">
      <h2>Czat dot. rezerwacji #{{ reservationId() }}</h2>
    </div>
  </header>

  <div class="messages-area" #messagesContainer>
    @if (chatResource.isLoading()) {
      <div class="loading-state">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    } @else if (chatResource.error()) {
      <div class="error-state">
        <mat-icon color="warn">error</mat-icon>
        <p>Błąd ładowania czatu.</p>
        <button mat-button color="primary" (click)="refreshMessages()">Spróbuj ponownie</button>
      </div>
    } @else {
      @if (chatResource.value(); as data) {
        @for (msg of data.messages; track $index) {
          <div
            class="message-row"
            [class.my-message-row]="msg.senderId === currentUserId()"
            [class.other-message-row]="msg.senderId !== currentUserId()"
          >
            <div
              class="message-bubble"
              matTooltip="{{ msg.sentAt | date: 'HH:mm' }}"
              [matTooltipPosition]="msg.senderId === currentUserId() ? 'before' : 'after'"
            >
              {{ msg.content }}
            </div>
          </div>
        } @empty {
          <div class="empty-state">
            <mat-icon>chat_bubble_outline</mat-icon>
            <p>Brak wiadomości. Rozpocznij rozmowę!</p>
          </div>
        }
      }
    }
  </div>

  <div class="input-area">
    <mat-form-field appearance="outline" class="full-width no-subscript">
      <input
        matInput
        placeholder="Napisz wiadomość..."
        [ngModel]="newMessageText()"
        (ngModelChange)="newMessageText.set($event)"
        (keyup.enter)="sendMessage()"
        autocomplete="off"
        [disabled]="chatResource.isLoading() || !!chatResource.error()"
      />
      <button
        mat-icon-button
        matSuffix
        color="primary"
        (click)="sendMessage()"
        [disabled]="!newMessageText() || chatResource.isLoading()"
      >
        <mat-icon>send</mat-icon>
      </button>
    </mat-form-field>
  </div>
</div>
