@if (dogResource.isLoading()) {
  <mat-spinner />
} @else if (dogResource.error()) {
  <mat-error>Nie udało się pobrać danych psa.</mat-error>
} @else if (dogResource.hasValue()) {
  @let dog = dogResource.value();

  <app-section-wrapper header="Pupil">
    <div class="dog-header">
      <div class="dog-photo-wrapper">
        @if (dog.photos.at(0); as photo) {
          <img class="dog-photo-main" [src]="photo.url" [alt]="dog.name" />
        } @else {
          <div class="dog-photo-placeholder">
            <mat-icon>pets</mat-icon>
          </div>
        }
      </div>

      <div class="dog-main-info">
        <div class="dog-name-row">
          <h2 class="dog-name">{{ dog.name }}</h2>

          @if (dog.ownerId === currentUserId()) {
            <button
              mat-icon-button
              matTooltip="Edytuj szczegóły psa"
              (click)="openEditDogDialog(dog)"
            >
              <mat-icon>edit</mat-icon>
            </button>
          }
        </div>

        <mat-chip-set>
          <mat-chip color="primary" selected>
            <mat-icon>category</mat-icon>
            <span>{{ dog.breed.name }}</span>
          </mat-chip>

          @if (dog.size) {
            <mat-chip>
              <mat-icon>straighten</mat-icon>
              <span>{{ dog.size }}</span>
            </mat-chip>
          }

          @if (dog.weightKg !== null) {
            <mat-chip>
              <mat-icon>scale</mat-icon>
              <span>{{ dog.weightKg }} kg</span>
            </mat-chip>
          }

          <mat-chip>
            <mat-icon>{{ dog.isActive ? 'check_circle' : 'cancel' }}</mat-icon>
            <span>{{ dog.isActive ? 'Aktywny' : 'Nieaktywny' }}</span>
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    @if (dog.notes) {
      <mat-divider></mat-divider>
      <div class="dog-description">
        <p>{{ dog.notes }}</p>
      </div>
    }

    @if (dog.photos.length > 0) {
      <mat-divider></mat-divider>
      <div class="dog-photos-extra">
        <div class="photos-row">
          @for (photo of dog.photos; track photo.photoId; let idx = $index) {
            @if (idx > 0) {
              <img
                class="dog-photo-thumb"
                [src]="photo.url"
                [alt]="dog.name + ' zdjęcie ' + (idx + 1)"
              />
            }
          }

          @if (dog.photos.length <= 1) {
            <span class="empty">Nie dodano więcej zdjęć</span>
          }
        </div>
      </div>
    }
  </app-section-wrapper>

  <app-section-wrapper header="Opinie">
    <mat-list>
      @for (review of reviews(); track review.id) {
        <mat-list-item class="review-item">
          <div class="review-item-container">
            <div class="review-content">
              <div class="review-header">
                <span class="author">{{ review.authorName }}</span>
                <span class="date">{{ review.createdAt | date: 'shortDate' }}</span>
              </div>
              <p class="text">{{ review.text }}</p>
            </div>

            <mat-button-toggle
              matTooltip="Zgłoś opinię do weryfikacji"
              [checked]="review.reported"
              (change)="onReportReview(review.id, $event.source.checked)"
            >
              <mat-icon [class.reported]="review.reported">flag</mat-icon>
            </mat-button-toggle>
          </div>
        </mat-list-item>
      } @empty {
        <span class="empty">Ten pies nie ma jeszcze opinii.</span>
      }
    </mat-list>

    <!-- <mat-divider class="reviews-divider"></mat-divider> -->

    <!-- <form [formGroup]="reviewForm" (ngSubmit)="onSubmitReview()" class="review-form" novalidate> -->
    <!--   <mat-form-field appearance="outline" class="full-width"> -->
    <!--     <mat-label>Dodaj opinię o tym psie</mat-label> -->
    <!--     <textarea matInput rows="4" formControlName="text"></textarea> -->
    <!--     @if (textControl.touched && textControl.invalid) { -->
    <!--       <mat-error>Opinia jest wymagana (min. 5 znaków).</mat-error> -->
    <!--     } -->
    <!--   </mat-form-field> -->
    <!---->
    <!--   <div class="review-actions"> -->
    <!--     <button mat-raised-button color="primary" type="submit" [disabled]="reviewForm.invalid"> -->
    <!--       Dodaj opinię -->
    <!--     </button> -->
    <!--   </div> -->
    <!-- </form> -->
  </app-section-wrapper>
}
