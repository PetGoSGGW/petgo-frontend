<div class="user-details-page">
  @if (user.isLoading()) {
    <mat-spinner />
  } @else if (user.error()) {
    <mat-error>Błąd podczas pobierania informacji o użytkowniku</mat-error>
  } @else if (user.hasValue() && user.value(); as user) {
    <div class="details-layout">
      <mat-card class="content-card main-info-card">
        <div class="user-header">
          <div class="user-photo-wrapper">
            @if (getAvatarUrl(); as avatar) {
              <img class="user-photo-main" [src]="avatar" [alt]="user.firstName" />
            } @else {
              <div class="user-photo-placeholder">
                <mat-icon>person</mat-icon>
              </div>
            }
          </div>

          <div class="user-main-text">
            <h2 class="user-name">
              {{ user.firstName }}
            </h2>

            <mat-chip-set>
              <mat-chip class="info-chip">
                <mat-icon>elderly</mat-icon>
                <span>wiek: {{ getAge(user.dateOfBirth) || '-' }}</span>
              </mat-chip>
            </mat-chip-set>
          </div>
        </div>

        <mat-divider></mat-divider>
        <div class="user-pets-section">
          <h3>Moje psy</h3>
          @if (dogs.isLoading()) {
            <mat-spinner />
          } @else if (dogs.error()) {
            <mat-error>Błąd podczas pobierania pupilów</mat-error>
          } @else if (dogs.hasValue()) {
            <div class="pets-list">
              @for (dog of dogs.value(); track dog.dogId) {
                <div class="pet-card-mini" [routerLink]="['/pets', dog.dogId]">
                  <img [src]="dog.photos[0].url" [alt]="dog.name" class="pet-mini-photo" />
                  <div class="pet-mini-info">
                    <span class="pet-name">{{ dog.name }}</span>
                    <span class="pet-details">{{ dog.breed.name }}, {{ dog.weightKg }}kg</span>
                  </div>
                </div>
              } @empty {
                <span class="empty">Nie znaleziono pupilów</span>
              }
            </div>
          }
        </div>
      </mat-card>

      <div class="right-column">
        @if (reviews.isLoading()) {
          <mat-spinner />
        } @else if (reviews.error()) {
          <mat-error>Błąd podczas pobierania opinii</mat-error>
        } @else if (reviews.hasValue()) {
          <mat-card class="content-card reviews-card">
            <div class="reviews-title-row">
              <h3>Opinie ({{ reviews.value().length }})</h3>
              <div class="rating-badge">
                <mat-icon>star</mat-icon>
                {{ score() }}
              </div>
            </div>
            <div class="reviews-list-container">
              @for (review of reviews.value(); track review; let last = $last) {
                <div class="review-row">
                  <div class="review-content-wrapper">
                    <div class="review-main-content">
                      <div class="review-header">
                        <span class="author">{{ review.author.firstName }}</span>
                        <span class="date">{{ review.createdAt | date: 'shortDate' }}</span>
                        <div class="star-rating-display">
                          @for (i of [1, 2, 3, 4, 5]; track i) {
                            <mat-icon class="star-icon-small">
                              {{ getRatingForReview(review.rating, i) }}
                            </mat-icon>
                          }
                        </div>
                      </div>

                      <p class="text">{{ review.comment }}</p>
                    </div>
                  </div>
                </div>

                @if (!last) {
                  <mat-divider></mat-divider>
                }
              }
            </div>
          </mat-card>
        }
      </div>
    </div>
  }
</div>
